<article>
  <h1>Under the hood</h1>

  <p>
    APIdocs is based on <a href="https://gatsbyjs.org">GatsbyJS</a>.
  </p>

  <p>
    The general idea behind APIdocs is to enable transformation of interlinked
    HTML pages to an easily-searchable static site. This approach lets you use
    any IDE for editing and previewing the source HTML, and things like file
    name auto-completion or id refactoring just work.
  </p>

  <section id="plugins">
    <h2>Gatsby plugins</h2>

    <p>
      APIdocs implementation consists of the following Gatsby plugins:
    </p>

    <ul>
      <li>
        <p>
          <a href="https://github.com/carrotsearch/gatsby-transformer-html"><code>@carrotsearch/gatsby-transformer-html</code></a>:
          a Gatsby transformer
          plugin for authoring content in HTML.
        </p>

        <p>
          One functional area of the plugin is enriching raw HTML content by:
        </p>

        <ul>
          <li>
            <p>
              rewriting local links to point to the generated Gatsby pages,
            </p>
          </li>

          <li>
            <p>
              adding section anchor links,
            </p>
          </li>

          <li>
            <p>
              processing linked images into multi-resolution responsive
              <code>img</code> tags,
            </p>
          </li>

          <li>
            <p>
              applying Prism.js highlighting to code blocks,
            </p>
          </li>

          <li>
            <p>
              embedding code examples from external files,
            </p>
          </li>

          <li>
            <p>
              adding synthetic identifiers to paragraph to make it possible
              to link to them from content search results.
            </p>
          </li>
        </ul>

        <p>
          Another functional area of the plugin is extracting paragraph-sized
          text snippets from the page, so that they can be indexed in a
          client-side in the client-side text search implemented by the
          <a href="https://github.com/carrotsearch/gatsby-plugin-content-search">gatsby-plugin-content-search</a>
          plugin
        </p>

        <p>
          The enriched HTML and lists of extracted text snippets are available
          in Gatsby's GraphQL model for use by other plugins.
        </p>
      </li>

      <li>
        <p>
          <a href="https://github.com/carrotsearch/gatsby-plugin-content-search"><code>@carrotsearch/gatsby-plugin-content-search</code></a>:
          a Gatsby plugin that takes all the text snippets extracted by the HTML
          transformer plugin and builds a <a
            href="https://github.com/farzher/fuzzysort">fuzzysort</a>index for
          them. Based on that index, a client-side Sublime-like searches can be
          applied to all the content in your documentation site.
        </p>
      </li>

      <li>
        <p>
          <a href="https://github.com/carrotsearch/gatsby-plugin-apidocs"><code>@carrotsearch/gatsby-plugin-apidocs</code></a>:
          a Gatsby plugin that implements APIdocs user interface, including
          navigation menus, search box, logo and footer customization options.
        </p>
      </li>

      <li>
        <p>
          <a href="https://github.com/carrotsearch/gatsby-plugin-relativize"><code>@carrotsearch/gatsby-plugin-relativize</code></a>:
          a Gatsby plugin that post-processes the output to remove the dependency on absolute URLs. The post-processed site should work when deployed at any URL prefix.
        </p>
      </li>
    </ul>

    <p>
      Additionally, the following plugins are required or recommended to
      use with APIdocs:
    </p>

    <ul>
      <li><code>gatsby-source-filesystem</code>: required </li>
      <li><code>gatsby-plugin-react-helmet</code>: required </li>
      <li><code>gatsby-plugin-dark-mode</code>: required </li>
      <li><code>gatsby-plugin-offline</code>: recommended </li>
      <li><code>gatsby-plugin-catch-links</code>: recommended </li>
    </ul>
  </section>

  <section id="why-not-markdown">
    <h2>Why not Markdown?</h2>

    <p>
      The majority of Gatsby plugins seems to be centered around Markdown, we
      also tried it for the initial prototypes of APIdocs. While Markdown has
      many advantages, such as concise syntax, we found it hard to use for
      more complex technical documentation:
    </p>

    <ul>
      <li>
        <p>
          <strong>Missing features.</strong>
          We wanted to be able to output HTML with arbitrary CSS classes. This
          is possible through a plugin, but makes the syntax ugly. There is
          no standard Markdown support for definition lists. This could probably
          be patched by adding more ugly syntax.
        </p>
      </li>

      <li>
        <p>
          <strong>Post-processing.</strong>
          To implement client-side search, we'd have to post-process the HTML
          generated by Markdown. We felt that if we decide to post-process
          things, we'd rather post-process simple semantic HTML source
          content rather than Markdown-generated HTML.
        </p>
      </li>

      <li>
        <p>
          <strong>Previewing source content.</strong>
          HTML files can be previewed directly in the browser, IDE support for
          advanced editing and refactoring is probably better for HTML too.
        </p>
      </li>
    </ul>
  </section>
</article>